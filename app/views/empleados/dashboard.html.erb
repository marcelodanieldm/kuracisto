
<div class="max-w-6xl mx-auto p-4 grid grid-cols-1 md:grid-cols-4 gap-6">
  <h1 class="text-3xl font-bold mb-6 text-blue-800">Dashboard Empleado</h1>


  <div class="md:col-span-3 mb-8 bg-white rounded shadow p-4">
    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 gap-4">
      <div class="mb-2">
        <%= link_to "Reservar turno", "#calendar-section", class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-semibold transition" %>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-blue-700">Administrar pacientes</h2>
      </div>
      <div class="flex gap-2 items-center">
        <%= form_with url: empleados_dashboard_path, method: :get, local: true, class: "flex gap-2" do |f| %>
          <%= f.text_field :busqueda, value: params[:busqueda], placeholder: "Buscar por nombre o apellido", class: "border rounded px-2 py-1 text-sm" %>
          <%= f.submit "Buscar", class: "bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-semibold transition" %>
        <% end %>
        <%= link_to "Agregar paciente", nuevo_paciente_empleados_path, class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-semibold transition" %>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">DNI</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Teléfono</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Última visita</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @pacientes.each do |p| %>
            <tr>
              <td class="px-4 py-2"><%= p.full_name %></td>
              <td class="px-4 py-2"><%= p.dni %></td>
              <td class="px-4 py-2"><%= p.telefono %></td>
              <td class="px-4 py-2"><%= p.tipo_seguro %></td>
              <td class="px-4 py-2"><%= p.turnos.last&.fecha || "Nunca" %></td>
              <td class="px-4 py-2 space-x-2">
                <%= link_to "Editar", editar_paciente_empleados_path(p), class: "bg-yellow-400 hover:bg-yellow-500 text-white px-2 py-1 rounded text-xs font-semibold transition" %>
                <%= link_to "Borrar", eliminar_paciente_empleados_path(p), method: :delete, class: "bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs font-semibold transition", data: { confirm: "¿Estás seguro?" } %>
                <%= button_to "Reservar turno", '#', class: "bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs font-semibold transition reservar-turno-btn", data: { paciente_id: p.id } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <%= render 'shared/calendar', turnos: @turnos %>
  <%= render 'shared/calendar_modal', pacientes: @pacientes %>

  <div class="md:col-span-3 mb-8 bg-white rounded shadow p-4">
    <h2 class="text-xl font-semibold mb-4 text-blue-700">Envío de email</h2>
    <% @pacientes.first(3).each do |p| %>
      <%= form_with url: enviar_email_paciente_empleados_path(paciente_id: p.id), method: :post, class: "mb-4" do |f| %>
        <%= f.label :mensaje, "Mensaje:", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_area :mensaje, rows: 3, class: "mt-1 block w-full border-gray-300 rounded-md" %>
        <%= f.submit "Enviar email a #{p.nombre}", class: "bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-semibold transition mt-2" %>
      <% end %>
      <hr class="my-2">
    <% end %>
  </div>

  <div class="md:col-span-3 mb-8 bg-white rounded shadow p-4">
</div>
<!-- Columna lateral de próximos turnos -->
<div class="md:col-span-1 bg-white rounded shadow p-4 h-fit">
  <h2 class="text-xl font-semibold mb-4 text-blue-700">Próximos 10 turnos</h2>
  <ul class="divide-y divide-gray-200">
    <% @turnos.first(10).each do |t| %>
      <li class="py-2">
        <span class="font-semibold text-gray-800"><%= t.fecha %> <%= t.hora %></span><br>
        <span class="text-sm text-gray-600"><%= t.paciente.full_name %></span>
      </li>
    <% end %>
  </ul>
</div>
    <h2 class="text-xl font-semibold mb-4 text-blue-700">Asistencia</h2>
    <div class="mb-2">
      <h5 class="font-semibold text-green-700">✅ Asistieron</h5>
      <ul class="list-disc pl-5 text-gray-700">
        <% @asistieron.each do |t| %>
          <li><%= t.paciente.full_name %> - <%= t.fecha %> a <%= t.hora %></li>
        <% end %>
      </ul>
    </div>
    <div>
      <h5 class="font-semibold text-red-700">❌ Faltaron</h5>
      <ul class="list-disc pl-5 text-gray-700">
        <% @faltaron.each do |t| %>
          <li><%= t.paciente.full_name %> - <%= t.fecha %> a <%= t.hora %></li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
