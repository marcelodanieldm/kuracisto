<!-- Calendar block from Tailwind UI, adapted for ERB usage -->
<div id="calendar-section" class="overflow-hidden bg-white shadow rounded-lg">
  <div class="px-4 py-5 sm:p-6">
    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Calendario</h3>
    <div class="border-t border-gray-200 mt-2">
      <!-- Aquí puedes renderizar los días y eventos dinámicamente -->
      <div class="grid grid-cols-7 gap-2 mt-4">
        <% turnos_por_dia = (@turnos || []).group_by { |t| t.fecha } %>
        <% inicio_semana = Date.today.beginning_of_week(:monday) %>
        <% fin_semana = inicio_semana + 6 %>
        <% inicio_semana.upto(fin_semana) do |date| %>
          <% reservados = (turnos_por_dia[date] || []).select { |t| t.estado == 'reservado' } %>
          <% disponibles = (turnos_por_dia[date] || []).select { |t| t.estado == 'disponible' } %>
          <div class="calendar-day flex flex-col items-center p-2 rounded-lg cursor-pointer transition hover:bg-blue-200 <%= 'bg-blue-100' if date == Date.today %> <%= reservados.any? ? 'ring-2 ring-red-500' : disponibles.any? ? 'ring-2 ring-green-500' : '' %>" data-date="<%= date %>">
            <span class="text-xs font-semibold <%= 'text-blue-700' if date == Date.today %>"><%= date.day %></span>
            <% if reservados.any? %>
              <ul class="mt-1 space-y-1 w-full">
                <% reservados.each do |turno| %>
                  <li class="text-xs bg-red-100 text-red-800 rounded px-1 py-0.5 w-full flex justify-between items-center">
                    <span><%= turno.paciente.full_name %> <%= turno.hora.strftime('%H:%M') %></span>
                    <span class="flex gap-1">
                      <button type="button" class="text-xs px-1 py-0.5 rounded bg-yellow-200 hover:bg-yellow-300 text-yellow-900 font-bold" onclick="openEditTurnoModal(<%= turno.id %>, '<%= turno.fecha %>', '<%= turno.hora.strftime('%H:%M') %>', <%= turno.paciente_id %>)">Editar</button>
                      <%= button_to 'Eliminar', turno_path(turno), method: :delete, class: 'text-xs px-1 py-0.5 rounded bg-red-600 hover:bg-red-700 text-white font-bold', data: { confirm: '¿Eliminar turno?' } %>
                    </span>
                  </li>
                <% end %>
              </ul>
            <% end %>
            <% if disponibles.any? %>
              <ul class="mt-1 space-y-1 w-full">
                <% disponibles.each do |turno| %>
                  <li class="text-xs bg-green-100 text-green-800 rounded px-1 py-0.5 w-full"><%= turno.paciente.full_name %> <%= turno.hora.strftime('%H:%M') %></li>
                <% end %>
              </ul>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
